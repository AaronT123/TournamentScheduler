@model TournamentScheduler.Models.Tournament

@{
    ViewBag.Title = "RoundRobin";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<h2>RoundRobin</h2>

<h4>Team Scores</h4>
<table>
    <tr>
        <th>
            Team
        </th>
        <th>
            Score
        </th>
    </tr>

    @foreach (var team in Model.Teams)
    {
        <tr>
            <td>
                @team.TeamName
            </td>
            <td>
                @{
                    int scoreCount = 0;
                    foreach (var fixture in Model.RRFixtures)
                    {
                        if (fixture.Team1Name == team.TeamName)
                        {
                            if (fixture.Team1Score == 1)
                            {
                                scoreCount += 1;
                            }
                        }
                        if (fixture.Team2Name == team.TeamName)
                        {
                            if (fixture.Team2Score == 1)
                            {
                                scoreCount += 1;
                            }
                        }
                    }
                    <p>@scoreCount</p>
                }
            </td>
        </tr>
    }
</table>
<br />
<h2>Fixtures</h2>
<br />
@{
    int FinalRound = 0;
    foreach (var fixture in Model.RRFixtures)
    {
        if (fixture.RoundNumber > FinalRound)
        {
            FinalRound = fixture.RoundNumber;
        }
    }
}

@for (var roundCount = 1; roundCount <= FinalRound; roundCount++)
{
    <h4>Round @roundCount</h4>
    <table>
        <tr>
            <th>Team 1 Score</th>
            <th>Team 1</th>
            <th></th>
            <th>Team 2</th>
            <th>Team 2 Score</th>
        </tr>

        @foreach (var fixture in Model.RRFixtures)
        {
            if (roundCount == fixture.RoundNumber)
            {
                if (fixture.Team1Name != null)
                {
                    if (fixture.Team2Name != null)
                    {
                        <tr>
                            <td>
                                @fixture.Team1Score
                            </td>
                            <td>
                                @fixture.Team1Name
                            </td>
                            <td>
                                VS
                            </td>
                            <td>
                                @fixture.Team2Name
                            </td>
                            <td>
                                @fixture.Team2Score
                            </td>
                            <td>
                                <p>@Html.ActionLink("Choose Winner", "Edit", "RRFixture", new { id = fixture.RRFixtureID }, null)</p>
                            </td>
                        </tr>
                    }
                }
            }
        }
    </table>
    <br />
}
